'use client';
import { useEffect, useState } from 'react';
import { useSearchParams } from 'next/navigation';
import styles from './ServicesPage.module.css';

interface Service {
  id: number;
  title: string;
  duration: string;
  description: string;
  price: string;
}

const individualServices: Service[] = [
  {
    id: 1,
    title: 'Консультирование',
    duration: '1 - 1,5 часа',
    description: 'Встреча, на которой обсуждается и анализируется запрос клиента и вырабатываются шаги по изменению ситуации и достижению требуемых результатов. Проводится в формате онлайн в любом удобном для клиента приложении.',
    price: 'от 4 000 до 5 000 ₽ в зависимости от продолжительности (при покупке более 10 консультаций предоставляется скидка).',
  },
  {
    id: 2,
    title: 'Срочное консультирование',
    duration: '-',
    description: 'Консультация в течение 2 ближайших дней при отсутствии свободных слотов.',
    price: '+ 5 000 ₽ к стоимости услуги',
  },
  {
    id: 3,
    title: 'Супер срочное консультирование',
    duration: '-',
    description:
      'Консультация в текущий день, при поступлении заявки до 20:00 по московскому времени, либо утром следующего дня.',
    price: '+ 20 000 ₽ к стоимости услуги',
  },
  {
    id: 4,
    title: 'Работа с негативным состоянием',
    duration: '4 часовых сеанса (1 месяц)',
    description:
      'Выявляем причины возникновения негативного состояния путем интервью, проведения специальных тестов и фиксации своего состояния в течение недели, анализируем полученные результат, вырабатываем эффективную стратегию улучшения состояни и недопущения повторения текущей ситуации в дальнейшем. Улучшения обычно наступают после первого сеанса, но для того, чтобы всё не вернулось нужно разобраться со всеми причинами.',
    price: '20 000 ₽',
  },
  {
    id: 5,
    title: 'Диагностика',
    duration: '8 часовых сеансов (1 - 2 месяца)',
    description:
      'Услуга включает в себя интервью, 7 методик на выбор специалиста, анализ полученных результатов, их обсуждение с клиентом и предоставление рекомендаций. В рамках данной услуги анализируется личность клиента не только в профессиональном плане. Подходит тем, кто хочет глубже узнать себя.',
    price: '40 000 ₽',
  },
  {
    id: 6,
    title: 'Составление резюме',
    duration: '5 рабочих дней + 2 встречи',
    description:
      ' Услуга включает в себя анализ вакансий по данной профессии и анализ резюме представленных на HH.ru и составление для кандидата качественного резюме привлекательного для потенциальных работодателей. Возможно изготовление нескольких вариантов резюме индивидуально под наиболее интересные вакансии. Также клиенту будут даны рекомендации по отклику на вакансии и прохождению собеседования. Клиент должен сам сделать и предоставить фото в соответсвии с рекомендациями. Рекомендуется сразу после записи на услугу направить информацию об интересующей профессии с указанием города.',
    price: 'от 20 000 ₽',
  },
  {
    id: 7,
    title: 'Проверка готового резюме и его обсуждение на личной встрече',
    duration: '3 рабочих дня + 1 встреча',
    description: 'Услуга включает в себя анализ вакансий по данной профессии представленных на HH.ru и проверку резюме клиента на соответствие вакансиям и принятым стандартам. По итогу встречи клиент получает список рекомендацию по улучшению резюме, отклику на вакансии и прохождению собеседования.',
    price: '8 000 ₽',
  },
  {
    id: 8,
    title: 'Проверка готового резюме и обратная связь по нему в текстовом виде',
    duration: '3 рабочих дня',
    description: 'Услуга включает в себя быстрый анализ вакансий по данной профессии представленных на HH.ru и проверку резюме клиента на соответствие вакансиям и принятым стандартам. По итогу встречи клиент получает список рекомендацию по улучшению резюме.',
    price: '2 000 ₽',
  },
  {
    id: 9,
    title: 'Тестовое собеседование',
    duration: '5 рабочих дней + 2-х часовая встреча',
    description:
      'Услуга включает в себя анализ вакансий по данной профессии, подготовку и проведение тестового собеседования, и обратную связь по его результатам. Также клиенту будут даны рекомендации по прохождению собеседования и передан примерный список заданий и вопросов для подготовки к нему. Для некоторых узкопрофильных профессий, требующих глубокого погружения в профессиональную сферу стоимость услуги может быть выше или не оказываться вообще.',
    price: '20 000 ₽',
  },
  {
    id: 10,
    title: 'Тестовое собеседование по материалам от кандидата',
    duration: '2 часа',
    description:
      'Услуга включает в себя репетицию собеседования, обратную связь по его результатам и рекомендации по прохождению собеседований и поведению во время их проведения. Список вопросов предоставляет клиент. Психолог, на своё усмотрение, может задавать дополнительные и уточняющие вопросы.',
    price: '8 000 ₽',
  },
  {
    id:11,
    title: 'Обратная связь по результату собеседования',
    duration: '3 рабочих дня + консультация',
    description:
      'Для оказания данной услуги клиент должен предоставить аудио или видеозапись прохождения собеседования. По результатам изучения записи клиенту будут дан список рекомендаций по поведению во время собеседования, изучению материала, для ответов на вопросы, во время собеседования, и методики работы со стрессом и своим состоянием.',
    price: '8 000 ₽',
  },
  {
    id: 12,
    title: 'Карьерное консультирование в сфере ИТ',
    duration: '2 часа',
    description:
      'Рекомендации по выбору специализации в сфере ИТ на основании личностных качеств и опыта работы клиента, рекомендации по выбору формата обучения и обучающих программ, оформлению резюме и трудоустройству.',
    price: '8 000 ₽ (для школьников и студентов — 6 000 ₽)',
  },
  {
    id: 13,
    title: 'Коучинг, наставничество, повышение личностной эффективности',
    duration: '4 часовых сеанса (1 месяц)',
    description:
      'Определение целей, проверка их на значимость для клиента (не всегда то, что мы хотим, это то, что соответствует нашим ценностям, планам и долгосрочным целям, иногда это навязано другими), составление плана по их достижению, контроль и мотивация в процессе. По желанию клиента сеансы могут быть разбиты на более короткие или заменены на звонки либо общение в мессенджере.',
    price: '20 000 ₽',
  },
];

const businessServices: Service[] = [
  {
    id: 14,
    title: 'Вводное знакомство',
    duration: 'около 1 часа',
    description: 'Встреча для обсуждения интересующих услуг и процесса работы.',
    price: 'бесплатно',
  },
  {
    id: 15,
    title: 'Консультирование',
    duration: '1 час',
    description: 'Консультации организационного психолога для сотрудников вашей компании по разрешению рабочих ситуаций, состоянию, мотивации, планам роста и другим.',
    price: '4 000 ₽ в час, при покупке более 40 часов скидки',
  },
  {
    id: 16,
    title: 'Комплексная диагностика компании',
    duration: '1 месяц',
    description: 'Одна или несколько вводных встреч с руководством или собственником для составления списка проблем. Составления детального плана по диагностике организации и его реализация. Анализ полученных результатов, составления отчета и презентации по выявленным проблемам и их причинам и включающий рекомендации по изменению ситуации. Руководитель организации должен обеспечить участие персонала в проведении диагностики.',
    price: 'от 100 000 ₽ для малого бизнеса',
  },
  {
    id: 17,
    title: 'Анализ состояния сотрудников',
    duration: '2 - 3 недели',
    description: 'Встреча с руководством для конкретизации запроса и установления списка причин, которые могут влиять на состояние сотрудников. Выбор методик и разработка детального плана диагностики. Проведение диагностики, анализ полученных результатов и их презентация, включающая список рекомендаций. При наличии в компании HR специалиста рекомендуется его привлечение в процессе оказания услуги.',
    price: 'от 40 000 ₽ для компаний с количеством сотрудников менее 20',
  },
  {
    id: 18,
    title: 'Разработка плана мероприятий по повышению вовлеченности и мотивации сотрудников',
    duration: '2 - 3 недели',
    description: 'Анализ текущего взаимодействия компании со своими сотрудниками. Выявление потенциально проблемных моментов и узких мест. Разработка плана мероприятий по повышению вовлеченности и мотивации сотрудников с учетом бюджета компании. План может включать: рекомендации руководству по изменению взаимодействия с сотрудниками, рекомендации по проведению мероприятий как с привлечением внешних специалистов, так и внутренних, рекомендации по изменению корпоративной культуры и другие. Рекомендуется проводить после анализа состояния сотрудников.',
    price: 'от 50 000 ₽',
  },
  {
    id: 19,
    title: 'Проведение оценки сотрудников',
    duration: '1,5 месяца (для группы более 50 человек срок может быть увеличен)',
    description: 'Оценка профессиональных навыков сотрудника и их применимости на занимаемой должности, оценка мотивации сотрудника, его вовлеченности, лояльности к компании, понимания её миссии и ценностей, готовности к развитию и другого. По итогам готовится общий отчёт включающий индивидуальные рекомендации и прогнозы по каждому сотруднику.',
    price: '20 000 ₽/чел. (скидки от 20 чел.) Оценка узкопрофильных специалистов требующая глубокого погружения в предметную область дороже в 2 раза.',
  },
  {
    id: 20,
    title: 'Разработка профессиограммы для найма сотрудников',
    duration: '1 неделя',
    description: 'Подготовка документа, описывающего должность и качества кандидата, которыми он должен обладать для эффективной работы в рамках этой должности. Включает в себя рекомендации по проверке этих качеств во время собеседования.',
    price: '20 000 ₽',
  },
  {
    id: 21,
    title: 'Разработка рекомендаций по проведению собеседования для выявления требуемых качеств сотрудника',
    duration: '1 неделя',
    description: 'Готовиться под заданную вакансию или группу схожих вакансий. Составляется и предоставляется документ содержащий список рекомендуемых качеств кандидата со способами их проверки во время проведения собеседования. Проверки включают в себя как список вопросов, и желаемых ответов к ним, так и кейсы с методами их решения и выводами, которые могут быть сделаны на основании их.',
    price: 'от 12 000 ₽',
  },
  {
    id: 22,
    title: 'Проведение собеседования или участие в нем с предоставлением обратной связи',
    duration: '1 собеседование + 1 рабочий день',
    description:
      'Услуга включает в себя подготовку к собеседованию, согласование его плана и списка вопросов, наблюдение за кандидатом во время собеседования и предоставления обратной связи по его результату. В случае, если рекомендованный сотрудник не прошел испытательный срок (3 месяца) или уволился раньше, повторная услуга оказывается бесплатно при условии предоставлении контакта ушедшего сотрудника.',
    price: 'от 12 000 ₽ (скидка при объеме свыше 10 собеседований)',
  },
  {
    id: 23,
    title: 'Разработка стиля компании её миссии и ценностей',
    duration: '2 недели (не менее 4 встреч с руководством)',
    description:'Как говорится, как корабль назовёшь, так он и поплывет. Данная услуга помогает разобраться, что является важным и приоритетным именно для вашего бизнеса, для чего он был создан и какой смысл несёт. На проверку, обычно всё оказывается не так просто, как кажется на первый взгляд. В рамках услуги выявляются именно истинные цели и мотивы. В услугу также входят рекомендации по донесению полученной информации до персонала',
    price: 'от 50 000 ₽',
  },
  {
    id: 24,
    title: 'Разработка стратегии компании для привлечения клиентов и сотрудников',
    duration: 'от 2 недель (включая не менее 2 встреч)',
    description: 'Услуга чем-то похожа на маркетинговое продвижение, но предполагает в первую очередь психологический подход к анализу целевой аудитории, имиджа, который компаний хочет иметь в её глазах, и ассоции, которые хочет вызывать. По результатам работы предоставляется отчет с рекомендациями и проводится презентация.',
    price: 'от 50 000 ₽',
  },
  {
    id: 25,
    title: 'Проведение модерационных сессий',
    duration: '2 часа + 2 недели подготовки до начала мероприятия + неделя на обработку и систематизацию результата после проведения мероприятия',
    description:
      'Мероприятие проводится для сотрудников компании. Его цель выработать эффективное решение по вопросу. Модератор, в моем лице, осуществляет проведение данной сессии, в рамках которой используются несколько методик, подобранных индивидуально под конкретный запрос клиента. После проведения мероприятия все полученные результаты анализируются и систематизируются в виде отчета.',
    price: '50 000 ₽ онлайн / 80 000 ₽ очно + командировочные расходы при проведении мероприятия в другом городе (до середины 2026 года я не провожу выездные мероприятия лично, а подключаю помощников)',
  },
  {
    id: 26,
    title: 'Тренинги и обучение',
    duration: '1 час + 2 недели подготовки  до начала мероприятия',
    description:
      'В зависимости от запроса, мероприятие может включать в себя лекцию по заданной тематике, либо проводится интерактивно в формате выполнения заданий и решения бизнес кейсов. Рекомендуемое количество участников тренинга 10 человек, допустимое до 20, количество участников лекций неограниченно.',
    price: '30 000 ₽ онлайн / 50 000 ₽ очно + командировочные расходы при проведении мероприятия в другом городе (до середины 2026 года я не провожу выездные мероприятия лично, а подключаю помощников). Стоимость цикла из нескольких занятий обсуждается индивидуально. Повторное проведение занятия по тому же материалу + 5 000 рублей.',
  },
];


export default function ServicesPage() {
  const searchParams = useSearchParams();
  const initialTab = searchParams.get('type') === 'business' ? 'business' : 'individual';
  const [tab, setTab] = useState<'individual' | 'business'>(initialTab);
  const services = tab === 'individual' ? individualServices : businessServices;

  const [selectedService, setSelectedService] = useState<null | Service>(null);
  const [formSent, setFormSent] = useState(false);

  const closeModal = () => setSelectedService(null);

  const handleSubmit = async (
    e: React.FormEvent<HTMLFormElement>,
    selectedServiceId: number
  ) => {
    e.preventDefault();
    const form = e.currentTarget;
    const formData = new FormData(form);

    const payload = {
      full_name: formData.get('full_name'),
      phone: formData.get('phone'),
      email: formData.get('email'),
      request_text: formData.get('request_text'),
      client_type: formData.get('client_type'),
      preferred_communication: formData.get('preferred_communication'),
      selected_service: selectedServiceId,
    };

    try {
      const res = await fetch('http://localhost:8000/api/requests/create/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      });

      if (!res.ok) throw new Error('Ошибка при отправке формы');

      setFormSent(true);
      setTimeout(() => {
        setFormSent(false);
        closeModal();
      }, 2000);
    } catch (error) {
      console.error('Ошибка отправки:', error);
      alert('Ошибка при отправке формы. Попробуйте позже.');
    }
  };

  return (
    <div className={styles.servicesPage}>
      <div className={styles.tabs}>
        <button className={tab === 'individual' ? styles.active : ''} onClick={() => setTab('individual')}>
          Физические лица
        </button>
        <button className={tab === 'business' ? styles.active : ''} onClick={() => setTab('business')}>
          Юридические лица
        </button>
      </div>

      <div className={styles.servicesList}>
        {services.map((service) => (
          <div key={service.id} className={styles.serviceCard}>
            <h3>{service.title}</h3>
            <p><strong>Продолжительность:</strong> {service.duration}</p>
            <p><strong>Описание:</strong> {service.description}</p>
            <p><strong>Стоимость:</strong> {service.price}</p>
            <button className={styles.signupButton} onClick={() => setSelectedService(service)}>
              Записаться
            </button>
          </div>
        ))}
      </div>

      {selectedService && (
        <div className={styles.modalOverlay} onClick={closeModal}>
          <div className={styles.modal} onClick={(e) => e.stopPropagation()}>
            <button className={styles.closeButton} onClick={closeModal}>×</button>
            <h2>Запись на услугу: {selectedService.title}</h2>
            <form className={styles.form} onSubmit={(e) => handleSubmit(e, selectedService.id)}>
              <label>ФИО:
                <input type="text" name="full_name" required />
              </label>
              <label>Телефон:
                <input type="tel" name="phone" required />
              </label>
              <label>Email:
                <input type="email" name="email" required />
              </label>
              <label>Тип клиента:
                <select name="client_type" required className={styles.selectInput}>
                  <option value="">-- Выберите --</option>
                  <option value="individual">Физическое лицо</option>
                  <option value="organization">Юридическое лицо</option>
                </select>
              </label>

              <label>Предпочитаемый способ связи:
                <select name="preferred_communication" required className={styles.selectInput}>
                  <option value="">-- Выберите --</option>
                  <option value="email">Email</option>
                  <option value="phone">Телефон</option>
                </select>
              </label>
              <label>Комментарий:
                <textarea name="request_text" rows={3} required />
              </label>
              <button type="submit">Отправить</button>
            </form>
          </div>
        </div>
      )}

      {formSent && (
        <div className={styles.toast}>Спасибо за заявку!</div>
      )}
    </div>
  );
}
